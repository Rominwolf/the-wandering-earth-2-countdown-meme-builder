(globalThis["webpackChunkthe_wandering_earth_2_countdown"]=globalThis["webpackChunkthe_wandering_earth_2_countdown"]||[]).push([[994],{6391:(e,t,l)=>{"use strict";l.r(t),l.d(t,{default:()=>K});var a=l(9835);function o(e,t,l,o,n,i){const d=(0,a.up)("FabricCanvas"),s=(0,a.up)("q-page-container"),u=(0,a.up)("CanvasConfigs"),r=(0,a.up)("q-layout");return(0,a.wg)(),(0,a.j4)(r,{view:"lHh Lpr lFf"},{default:(0,a.w5)((()=>[(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d)])),_:1}),(0,a.Wm)(u)])),_:1})}const n=e=>((0,a.dD)("data-v-fa246964"),e=e(),(0,a.Cn)(),e),i={id:"canvasContainer"},d=n((()=>(0,a._)("canvas",{id:"canvas"},null,-1))),s=[d];function u(e,t,l,o,n,d){return(0,a.wg)(),(0,a.iD)("div",i,s)}var r=l(5851),c=l(8369),m=l.n(c),p=l(2525),h=l(6646),g=l(4328);let f=null;const w={name:"FabricCanvas",data(){return{background:null,exportBlob:null}},methods:{init(){let e=this,t=this.$q.screen.width,a=this.$q.screen.height;f=new r.fabric.Canvas("canvas",{width:.8*t,height:a,backgroundColor:"rgba(0,0,0,0)"}),this.$bus.on("canvas-refresh",((t,l,a)=>{e.generate(t,a),e.setBackground(l)})),this.$bus.on("canvas-export",(e=>{let t=f["backgroundImage"],a=t["width"],o=t["height"],n=t["scaleX"],i=t["scaleY"],d=t["left"],s=t["top"],u=a*n,r=o*i,c=d-u/2,m=s-r/2,w=e;"clipboard"===e&&(w="jpeg");let b=f.toDataURL({width:u,height:r,left:c,top:m,format:w});if("countdown"===e&&(w="png",b=f.getObjects()[0].toDataURL({width:u,height:r,left:c,top:m,format:w})),"jpeg"===e||"png"===e||"countdown"===e){let e=l(3721),t=e(b);const a=(0,h.Z)("countdown-image."+w,t);a?g.Z.create({message:"已成功下载文件。",color:"positive",position:"top-left"}):g.Z.create({message:"下载文件失败。",color:"negative",position:"top-left"})}"clipboard"===e&&(0,p.VP)(b).then((()=>{g.Z.create({message:"已复制到剪贴板。",color:"positive",position:"top-left"})})).catch((()=>{g.Z.create({message:"无法复制到剪贴板。",color:"negative",position:"top-left"})}))}))},setBackground(e){let t=.8*this.$q.screen.width,l=this.$q.screen.height;r.fabric.Image.fromURL(e,(function(e){let a=e.width,o=e.height;o>a?e.scale(l/o):e.scale(t/a);let n=f.getCenter();f.setBackgroundImage(e,f.renderAll.bind(f),{top:n.top,left:n.left,originX:"center",originY:"center"}),f.renderAll()}))},generate(e,t){let l=this,a="rgba(0, 0, 0, 0.5) 0px 0px 15px",o="字魂59号-创粗黑",n="Alte DIN 1451 Mittelschrift gepraegt Regular",i=t["textColor"],d=t["hintColor"],s=t["mainSpacing"],u=t["subSpacing"],c=new(m())(o),p=new(m())(n);Promise.all([c.load(),p.load()]).then((function(){let t=new r.fabric.Rect({top:43,left:0,width:4,height:68,fill:d}),c=t["left"]+t["width"],m=new r.fabric.Text(e["start"].toString(),{top:34,left:c+4,fontFamily:o,fill:i,fontSize:36,shadow:a,charSpacing:s,lineHeight:.85}),p=m["left"]+m["width"],h=new r.fabric.Text(e["countdown"].toString(),{top:-4,left:p+4,fontFamily:n,fill:d,fontSize:84,shadow:a,charSpacing:0,lineHeight:.85}),g=h["left"]+h["width"],w=new r.fabric.Text(e["end"].toString(),{top:34,left:g,fontFamily:o,fill:i,fontSize:36,shadow:a,charSpacing:s,lineHeight:.85}),b=w["left"]+w["width"],v=new r.fabric.Text(e["sub"].toString().toUpperCase(),{top:76,left:c+6,fontFamily:n,fill:i,fontSize:18,shadow:a,charSpacing:u,lineHeight:.85}),V=new r.fabric.Text(e["top"].toString(),{top:0,left:p+2,fontFamily:o,fill:i,fontSize:36,shadow:a,textAlign:"right",originX:"right",charSpacing:s,lineHeight:.85}),C=(V["width"],new r.fabric.Group([t,V,m,h,w,v],{top:100,left:100}));C.setControlVisible("ml",!1),C.setControlVisible("mb",!1),C.setControlVisible("mr",!1),C.setControlVisible("mt",!1),C.setControlVisible("mtr",!1),f.add(C),l.updateGroupProps()}))},updateGroupProps(){if(f.getObjects().length<=1)return;let e=f.getObjects()[0],t=e["top"],l=e["left"],a=e["zoomX"],o=e["zoomY"],n=e["scaleX"],i=e["scaleY"];f.remove(f.getObjects()[0]),f.getObjects()[0].set({top:t,left:l,zoomX:a,zoomY:o,scaleX:n,scaleY:i}),f.getObjects()[0].setCoords()}},mounted(){this.init(),window.onresize=()=>{f.setWidth(.8*document.body.clientWidth),f.setHeight(document.body.clientHeight)}}};var b=l(1639);const v=(0,b.Z)(w,[["render",u],["__scopeId","data-v-fa246964"]]),V=v;var C=l(6970);const _=(0,a._)("h4",{class:"q-my-none q-pb-sm"},"基础",-1),x={class:"q-col-gutter-sm q-mb-sm"},W=(0,a._)("h4",{class:"q-my-none q-pb-sm"},"高级",-1),U=(0,a._)("a",{class:"text-subtitle2"},"标题文字字间距",-1),q=(0,a._)("a",{class:"text-subtitle2"},"底部文字字间距",-1),k=(0,a._)("h4",{class:"q-my-none q-pb-sm"},"鸣谢",-1);function y(e,t,l,o,n,i){const d=(0,a.up)("q-item-label"),s=(0,a.up)("q-item-section"),u=(0,a.up)("q-item"),r=(0,a.up)("q-list"),c=(0,a.up)("q-btn-dropdown"),m=(0,a.up)("q-card-actions"),p=(0,a.up)("q-file"),h=(0,a.up)("q-input"),g=(0,a.up)("q-color"),f=(0,a.up)("q-popup-proxy"),w=(0,a.up)("q-icon"),b=(0,a.up)("q-slider"),v=(0,a.up)("q-drawer"),V=(0,a.Q2)("close-popup"),y=(0,a.Q2)("ripple");return(0,a.wg)(),(0,a.j4)(v,{side:"right",modelValue:n.drawerRight,"onUpdate:modelValue":t[16]||(t[16]=e=>n.drawerRight=e),bordered:"",width:.2*this.$q.screen.width,breakpoint:500,class:"font-zihun bg-white q-px-md q-py-md"},{default:(0,a.w5)((()=>[(0,a.Wm)(m,{align:"right",class:"q-pa-none"},{default:(0,a.w5)((()=>[(0,a.Wm)(c,{color:"primary",label:"导出选项"},{default:(0,a.w5)((()=>[(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[(0,a.wy)(((0,a.wg)(),(0,a.j4)(u,{clickable:"",onClick:t[0]||(t[0]=e=>i.exportImage("jpeg"))},{default:(0,a.w5)((()=>[(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Uk)("下载缩略图 (JPEG)")])),_:1})])),_:1})])),_:1})),[[V]]),(0,a.wy)(((0,a.wg)(),(0,a.j4)(u,{clickable:"",onClick:t[1]||(t[1]=e=>i.exportImage("png"))},{default:(0,a.w5)((()=>[(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Uk)("下载原图 (PNG)")])),_:1})])),_:1})])),_:1})),[[V]]),(0,a.wy)(((0,a.wg)(),(0,a.j4)(u,{clickable:"",onClick:t[2]||(t[2]=e=>i.exportImage("clipboard"))},{default:(0,a.w5)((()=>[(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Uk)("复制缩略图到剪贴板")])),_:1})])),_:1})])),_:1})),[[V]]),(0,a.wy)(((0,a.wg)(),(0,a.j4)(u,{clickable:"",onClick:t[3]||(t[3]=e=>i.exportImage("countdown"))},{default:(0,a.w5)((()=>[(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Uk)("仅下载倒计时素材")])),_:1})])),_:1})])),_:1})),[[V]])])),_:1})])),_:1})])),_:1}),(0,a._)("div",null,[_,(0,a._)("div",x,[(0,a.Wm)(p,{filled:"",modelValue:n.image,"onUpdate:modelValue":[t[4]||(t[4]=e=>n.image=e),i.refresh],label:"背景图片","stack-label":"","model-value":n.image},null,8,["modelValue","model-value","onUpdate:modelValue"]),(0,a.Wm)(h,{filled:"",modelValue:n.texts.top,"onUpdate:modelValue":[t[5]||(t[5]=e=>n.texts.top=e),i.refresh],label:"顶部文字","model-value":n.texts.top},null,8,["modelValue","model-value","onUpdate:modelValue"]),(0,a.Wm)(h,{filled:"",modelValue:n.texts.start,"onUpdate:modelValue":[t[6]||(t[6]=e=>n.texts.start=e),i.refresh],label:"起始文字","model-value":n.texts.start},null,8,["modelValue","model-value","onUpdate:modelValue"]),(0,a.Wm)(h,{filled:"",type:"number",modelValue:n.texts.countdown,"onUpdate:modelValue":[t[7]||(t[7]=e=>n.texts.countdown=e),i.refresh],label:"倒计时数字","model-value":n.texts.countdown},null,8,["modelValue","model-value","onUpdate:modelValue"]),(0,a.Wm)(h,{filled:"",modelValue:n.texts.end,"onUpdate:modelValue":[t[8]||(t[8]=e=>n.texts.end=e),i.refresh],label:"结束文字","model-value":n.texts.end},null,8,["modelValue","model-value","onUpdate:modelValue"]),(0,a.Wm)(h,{filled:"",type:"textarea",modelValue:n.texts.sub,"onUpdate:modelValue":[t[9]||(t[9]=e=>n.texts.sub=e),i.refresh],label:"底部文字","model-value":n.texts.sub},null,8,["modelValue","model-value","onUpdate:modelValue"])])]),(0,a._)("div",null,[W,(0,a._)("div",null,[(0,a.Wm)(h,{filled:"",modelValue:n.advanced.textColor,"onUpdate:modelValue":[t[11]||(t[11]=e=>n.advanced.textColor=e),i.refresh],rules:["anyColor"],label:"文字颜色","model-value":n.advanced.textColor},{append:(0,a.w5)((()=>[(0,a.Wm)(w,{name:"colorize",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(f,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{modelValue:n.advanced.textColor,"onUpdate:modelValue":t[10]||(t[10]=e=>n.advanced.textColor=e),"model-value":n.advanced.textColor,onChange:i.refresh},null,8,["modelValue","model-value","onChange"])])),_:1})])),_:1})])),_:1},8,["modelValue","model-value","onUpdate:modelValue"]),(0,a.Wm)(h,{filled:"",modelValue:n.advanced.hintColor,"onUpdate:modelValue":[t[13]||(t[13]=e=>n.advanced.hintColor=e),i.refresh],rules:["anyColor"],label:"高亮颜色","model-value":n.advanced.hintColor},{append:(0,a.w5)((()=>[(0,a.Wm)(w,{name:"colorize",class:"cursor-pointer"},{default:(0,a.w5)((()=>[(0,a.Wm)(f,{cover:"","transition-show":"scale","transition-hide":"scale"},{default:(0,a.w5)((()=>[(0,a.Wm)(g,{modelValue:n.advanced.hintColor,"onUpdate:modelValue":t[12]||(t[12]=e=>n.advanced.hintColor=e),"model-value":n.advanced.hintColor,onChange:i.refresh},null,8,["modelValue","model-value","onChange"])])),_:1})])),_:1})])),_:1},8,["modelValue","model-value","onUpdate:modelValue"]),(0,a._)("div",null,[U,(0,a.Wm)(b,{modelValue:n.advanced.mainSpacing,"onUpdate:modelValue":[t[14]||(t[14]=e=>n.advanced.mainSpacing=e),i.refresh],min:-250,max:250,step:1,label:"","model-value":n.advanced.mainSpacing},null,8,["modelValue","onUpdate:modelValue","model-value"])]),(0,a._)("div",null,[q,(0,a.Wm)(b,{modelValue:n.advanced.subSpacing,"onUpdate:modelValue":[t[15]||(t[15]=e=>n.advanced.subSpacing=e),i.refresh],min:-250,max:250,step:1,label:"","model-value":n.advanced.subSpacing},null,8,["modelValue","onUpdate:modelValue","model-value"])])])]),(0,a._)("div",null,[k,(0,a.Wm)(r,null,{default:(0,a.w5)((()=>[((0,a.wg)(!0),(0,a.iD)(a.HY,null,(0,a.Ko)(n.suggestion,((e,t)=>(0,a.wy)(((0,a.wg)(),(0,a.j4)(u,{key:t,clickable:""},{default:(0,a.w5)((()=>[(0,a.Wm)(s,null,{default:(0,a.w5)((()=>[(0,a.Wm)(d,null,{default:(0,a.w5)((()=>[(0,a.Uk)((0,C.zw)(e.title),1)])),_:2},1024),(0,a.Wm)(d,{caption:""},{default:(0,a.w5)((()=>[(0,a.Uk)((0,C.zw)(e.sub),1)])),_:2},1024)])),_:2},1024)])),_:2},1024)),[[y]]))),128))])),_:1})])])),_:1},8,["modelValue","width"])}const S={name:"CanvasConfigs",data(){return{drawerRight:!0,image:null,texts:{top:"距填写倒计时文案",start:"大约还有",countdown:30,end:"秒",sub:"input countdown contents\nless than 30 seconds"},advanced:{textColor:"#FFFFFF",hintColor:"#FF0000",mainSpacing:-100,subSpacing:0},suggestion:[{title:"@Rominwolf",sub:"项目制作"},{title:"字魂59号-创粗黑",sub:"字体"},{title:"Alte DIN 1451 Mittelschrift gepraegt Regular",sub:"字体"},{title:"论2023年电影《流浪地球2》中使用的字体（附ttf） - https://www.bilibili.com/read/cv21439547",sub:"文章"}]}},methods:{exportImage(e){this.$bus.emit("canvas-export",e)},refresh(){let e=null;null!==this.image&&(e=window.URL.createObjectURL(this.image)),this.$bus.emit("canvas-refresh",this.texts,e,this.advanced)}},mounted(){this.refresh()}};var Z=l(906),F=l(1821),j=l(8479),Q=l(3246),I=l(490),z=l(1233),R=l(3115),L=l(1527),P=l(4152),D=l(2857),H=l(3050),$=l(7390),O=l(8423),T=l(2146),X=l(1722),Y=l(9984),A=l.n(Y);const B=(0,b.Z)(S,[["render",y]]),G=B;A()(S,"components",{QDrawer:Z.Z,QCardActions:F.Z,QBtnDropdown:j.Z,QList:Q.Z,QItem:I.Z,QItemSection:z.Z,QItemLabel:R.Z,QFile:L.Z,QInput:P.Z,QIcon:D.Z,QPopupProxy:H.Z,QColor:$.Z,QSlider:O.Z}),A()(S,"directives",{ClosePopup:T.Z,Ripple:X.Z});const M=(0,a.aZ)({name:"MainLayout",components:{CanvasConfigs:G,FabricCanvas:V}});var N=l(7605),E=l(2133);const J=(0,b.Z)(M,[["render",o]]),K=J;A()(M,"components",{QLayout:N.Z,QPageContainer:E.Z})},4960:()=>{},6759:()=>{},6272:()=>{}}]);